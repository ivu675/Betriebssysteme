# author: <dein Name>    version: 1.0
#
# docker-compose-Konfiguration für den Monitoring-Dienst.
#
# Zweck:
# - startet einen Container, der einfache Systemwerte vom Host (CPU, RAM, Disk)
#   ausliest und protokolliert
# - dazu werden /proc, /sys und das Root-Dateisystem des Hosts nur-lesend
#   in den Container gemountet
# - das INTERVAL legt fest, wie oft gemessen und geloggt wird
# - der Healthcheck ruft regelmäßig healthcheck.sh auf und markiert den
#   Container als "healthy" oder "unhealthy", je nachdem ob das Monitoring
#   noch Heartbeats schreibt

services:
  monitor:
    build: .
    image: team_2_06-monitor        
    container_name: monitor

    environment:
      # Abstand in Sekunden zwischen zwei Messungen
      INTERVAL: "60"

      # Zielpfad für die Host-Sichten innerhalb des Containers
      #LOG_FILE: "/data/system_monitor.log"
      HOST_PROC: "/host_proc"
      HOST_SYS: "/host_sys"
      HOST_ROOT: "/host_root"

    # Host-Verzeichnisse, die der Container lesen darf
    volumes:
      - /proc:/host_proc:ro       # Host-/proc read-only
      - /sys:/host_sys:ro         # Host-/sys read-only
      - /:/host_root:ro           # komplettes Host-Root read-only

    # Container automatisch neu starten, solange nicht bewusst gestoppt
    restart: unless-stopped

    # Healthcheck für den Container-Zustand
    healthcheck:
      test: ["CMD", "bash", "/app/healthcheck.sh"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

